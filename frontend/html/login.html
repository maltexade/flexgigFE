<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flexgig — Continue with Email</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="icon" href="/frontend/pwa/favicon.ico" />
  <style>
    :root {
      --bg: #080808;
      --blue: #2563eb;
      --green: #22c55e;
      --white: #ffffff;
      --muted: #9ca3af;
      --card: #0f1115;
      --border: #1f2937;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--white);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji;
    }
    .wrap {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 32px;
      background:
        radial-gradient(1000px 600px at 110% -10%, rgba(37,99,235,.18), transparent 70%),
        radial-gradient(800px 500px at -10% 110%, rgba(34,197,94,.18), transparent 70%);
    }
    .nav {
      position: fixed;
      top: 12px;
      right: 12px;
      left: 12px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    .nav a {
      color: var(--muted);
      text-decoration: none;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .nav a:hover { color: var(--white); }
    .card {
      width: 100%;
      max-width: 440px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 28px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
      animation: pop .25s ease-out;
    }
    @keyframes pop { from { transform: translateY(6px); opacity: 0; } to { transform: none; opacity: 1; } }
    h1 { margin: 0 0 8px; font-size: 28px; letter-spacing: .2px; }
    p.sub { margin: 0 0 24px; color: var(--muted); }
    .field { display: flex; flex-direction: column; gap: 8px; margin: 12px 0 18px; }
    .label { font-size: 14px; color: var(--muted); }
    .input {
      width: 100%;
      padding: 14px 40px 14px 14px; /* Add padding-right for eye SVG */
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #0b0d12;
      color: var(--white);
      outline: none;
      font-size: 16px;
    }
    .input:focus { border-color: var(--blue); box-shadow: 0 0 0 4px rgba(37,99,235,.15); }
    .error { color: #f87171; font-size: 14px; min-height: 18px; }
    .btn {
      width: 100%;
      padding: 14px 16px;
      border: 0;
      border-radius: 12px;
      color: var(--white);
      background: linear-gradient(90deg, var(--blue), var(--green));
      font-weight: 700;
      cursor: pointer;
    }
    .btn[disabled] { opacity: .6; cursor: not-allowed; }
    .hint { color: var(--muted); font-size: 13px; margin-top: 10px; }
    .center { text-align: center; }
    .otp-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin: 14px 0 18px; }
    .otp-grid input { text-align: center; font-size: 20px; padding: 14px 0; }
    .hidden { display: none; }
    .fade { animation: fade .18s ease-in; }
    @keyframes fade { from { opacity: .35; transform: translateY(4px); } to { opacity: 1; transform: none; } }
    .logo {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-weight: 800;
      background: linear-gradient(180deg, rgba(37,99,235,.25), rgba(34,197,94,.25));
      border: 1px solid var(--border);
      color: var(--white);
    }
    .row { display: flex; align-items: center; gap: 12px; }
    .password-field { position: relative; }
    .eye-toggle {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      width: 24px;
      height: 24px;
    }
    .loading {
      display: none;
      font-size: 14px;
      color: var(--muted);
      margin-top: 10px;
      text-align: center;
    }
    .loading.active { display: block; }
    .resend-btn {
      color: var(--muted);
      text-decoration: none;
      cursor: pointer;
    }
    .resend-btn:not([disabled]) { color: var(--blue); }
    .resend-btn:not([disabled]):hover { color: var(--green); }
    .resend-btn[disabled] { cursor: not-allowed; }
    .forgot-password {
      color: var(--white);
      text-decoration: none;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(255,255,255,.1);
      transition: background 0.2s;
    }
    .forgot-password:hover {
      background: rgba(255,255,255,.2);
      color: var(--green);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="nav">
      <a href="https://www.flexgig.com.ng" id="backTopRight" aria-label="Back to Flexgig">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        Back to flexgig.com.ng
      </a>
      <span></span>
    </div>

    <div class="card" id="step-email">
      <div class="row" style="margin-bottom:12px">
        <div class="logo">FG</div>
        <h1 style="margin:0">Continue with Email</h1>
      </div>
      <p class="sub">What is your email?</p>
      <div class="field">
        <label class="label" for="email">Email address</label>
        <input class="input" id="email" name="email" type="email" placeholder="you@domain.com" autocomplete="email" />
        <div class="error" id="emailErr"></div>
      </div>
      <button class="btn" id="emailContinue">Continue</button>
      <p class="loading" id="emailLoading">Verifying email...</p>
      <p class="hint center">We’ll check if you already have an account.</p>
    </div>

    <div class="card hidden" id="step-password">
      <a href="#" id="backToEmailPwd" class="nav a" style="float:left; margin-bottom:8px; color:var(--muted)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        Back
      </a>
      <h1>Welcome back</h1>
      <p class="sub" id="pwdFor"></p>
      <div class="field password-field">
        <label class="label" for="password">Password</label>
        <input class="input" id="password" name="password" type="password" placeholder="••••••••" autocomplete="current-password" />
        <svg class="eye-toggle" id="togglePassword" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <div class="error" id="passwordErr"></div>
      </div>
      <button class="btn" id="loginBtn">Login</button>
      <p class="hint center"><a href="#" id="forgotPassword" class="forgot-password">Forgot password?</a></p>
    </div>

    <div class="card hidden" id="step-otp">
      <a href="#" id="backToEmailOtp" class="nav a" style="float:left; margin-bottom:8px; color:var(--muted)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        Back
      </a>
      <h1>Enter the OTP</h1>
      <p class="sub" id="otpSentTo">We sent a code to your email.</p>
      <div class="otp-grid" id="otpGrid"></div>
      <div class="error" id="otpErr"></div>
      <button class="btn" id="verifyOtpBtn">Verify</button>
      <p class="hint center">
        Didn’t see it? <a href="#" id="resendOtp" class="resend-btn">Resend OTP</a>
        <span id="resendCountdown" class="hidden"></span>
      </p>
    </div>

    <div class="card hidden" id="step-setpwd">
      <h1>Set your password</h1>
      <p class="sub">Create a password for your new Flexgig account.</p>
      <div class="field password-field">
        <label class="label" for="newPassword">Password</label>
        <input class="input" id="newPassword" type="password" placeholder="At least 8 characters" />
        <svg class="eye-toggle" id="toggleNewPassword" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
      </div>
      <div class="field password-field">
        <label class="label" for="confirmPassword">Confirm password</label>
        <input class="input" id="confirmPassword" type="password" placeholder="Repeat password" />
        <svg class="eye-toggle" id="toggleConfirmPassword" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <div class="error" id="setPwdErr"></div>
      </div>
      <button class="btn" id="setPwdBtn">Save password</button>
    </div>

    <div class="card hidden" id="step-resetpwd">
      <a href="#" id="backToEmailReset" class="nav a" style="float:left; margin-bottom:8px; color:var(--muted)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        Back
      </a>
      <h1>Reset your password</h1>
      <p class="sub">Enter the code sent to your email and set a new password.</p>
      <div class="field">
        <label class="label" for="resetCode">Reset code</label>
        <input class="input" id="resetCode" type="text" placeholder="Enter the code" />
      </div>
      <div class="field password-field">
        <label class="label" for="resetNewPassword">New password</label>
        <input class="input" id="resetNewPassword" type="password" placeholder="At least 8 characters" />
        <svg class="eye-toggle" id="toggleResetNewPassword" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
      </div>
      <div class="field password-field">
        <label class="label" for="resetConfirmPassword">Confirm new password</label>
        <input class="input" id="resetConfirmPassword" type="password" placeholder="Repeat password" />
        <svg class="eye-toggle" id="toggleResetConfirmPassword" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <div class="error" id="resetPwdErr"></div>
      </div>
      <button class="btn" id="resetPwdBtn">Reset password</button>
    </div>
  </div>

  <script>
    // --- CONFIG ---
    const API_BASE = 'https://api.flexgig.com.ng';
    const WEB_BASE = 'https://www.flexgig.com.ng';
    const SUPABASE_URL = "https://bwmappzvptcjxlukccux.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ3bWFwcHp2cHRjanhsdWtjY3V4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0OTMzMjcsImV4cCI6MjA3MTA2OTMyN30.Ra7k6Br6nl1huQQi5DpDuOQSDE-6N1qlhUIvIset0mc";
    
    // Initialize Supabase client
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // --- STATE ---
    let currentEmail = '';
    const OTP_LENGTH = 6;
    let resendTimer = null;

    // Helpers
    const qs = (s) => document.querySelector(s);
    const show = (id) => { hideAll(); const el = qs(id); el.classList.remove('hidden'); el.classList.add('fade'); };
    const hideAll = () => ['#step-email', '#step-password', '#step-otp', '#step-setpwd', '#step-resetpwd'].forEach(s => qs(s).classList.add('hidden'));
    const maskEmail = (email) => {
      const [name, domain] = email.split('@');
      if (!name || !domain) return email;
      const visible = name.slice(0, 2);
      return `${visible}${'*'.repeat(Math.max(1, name.length - 2))}@${domain}`;
    };

    // Password visibility toggle
    const togglePasswordVisibility = (inputId, toggleId) => {
      const input = qs(inputId);
      const toggle = qs(toggleId);
      toggle.addEventListener('click', () => {
        const isPassword = input.type === 'password';
        input.type = isPassword ? 'text' : 'password';
        toggle.innerHTML = isPassword
          ? `<path d="M2 2l20 20M6 6l12 12M12 4c-4.5 0-8.2 3.7-9.9 8.8.7 2.8 2.4 5.2 4.7 6.8M12 20c4.5 0 8.2-3.7 9.9-8.8-.7-2.8-2.4-5.2-4.7-6.8"></path>`
          : `<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>`;
      });
    };
    togglePasswordVisibility('#password', '#togglePassword');
    togglePasswordVisibility('#newPassword', '#toggleNewPassword');
    togglePasswordVisibility('#confirmPassword', '#toggleConfirmPassword');
    togglePasswordVisibility('#resetNewPassword', '#toggleResetNewPassword');
    togglePasswordVisibility('#resetConfirmPassword', '#toggleResetConfirmPassword');

    // OTP inputs
    const otpGrid = qs('#otpGrid');
    for (let i = 0; i < OTP_LENGTH; i++) {
      const inp = document.createElement('input');
      inp.className = 'input';
      inp.maxLength = 1;
      inp.inputMode = 'numeric';
      inp.autocomplete = 'one-time-code';
      inp.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/\D/g, '');
        if (e.target.value && i < OTP_LENGTH - 1) {
          otpGrid.children[i + 1].focus();
        }
        if (i === OTP_LENGTH - 1 && e.target.value) {
          e.target.blur(); // Close keyboard on 6th digit
          qs('#verifyOtpBtn').click(); // Auto-submit OTP
        }
      });
      inp.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && !e.target.value && i > 0) {
          otpGrid.children[i - 1].focus();
        }
      });
      otpGrid.appendChild(inp);
    }

    // Handle OTP paste
    otpGrid.addEventListener('paste', (e) => {
      e.preventDefault();
      const paste = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '');
      if (!paste) return;
      const boxes = otpGrid.querySelectorAll('input');
      boxes.forEach((box, idx) => {
        box.value = paste[idx] || '';
      });
      const filled = Math.min(paste.length, OTP_LENGTH) - 1;
      if (filled >= 0) {
        boxes[filled].focus();
        if (filled === OTP_LENGTH - 1) {
          boxes[filled].blur(); // Close keyboard on paste
          qs('#verifyOtpBtn').click(); // Auto-submit OTP
        }
      }
    });

    // Resend OTP countdown
    const startResendCountdown = () => {
      const resendBtn = qs('#resendOtp');
      const countdownEl = qs('#resendCountdown');
      resendBtn.setAttribute('disabled', true);
      let timeLeft = 120; // 2 minutes in seconds
      countdownEl.classList.remove('hidden');
      countdownEl.textContent = `(Wait ${Math.floor(timeLeft / 60)}:${(timeLeft % 60).toString().padStart(2, '0')})`;
      resendTimer = setInterval(() => {
        timeLeft--;
        countdownEl.textContent = `(Wait ${Math.floor(timeLeft / 60)}:${(timeLeft % 60).toString().padStart(2, '0')})`;
        if (timeLeft <= 0) {
          clearInterval(resendTimer);
          resendBtn.removeAttribute('disabled');
          countdownEl.classList.add('hidden');
        }
      }, 1000);
    };

    // Step 1: Email continue
    qs('#emailContinue').addEventListener('click', async () => {
      const email = qs('#email').value.trim().toLowerCase();
      qs('#emailErr').textContent = '';
      qs('#emailLoading').classList.add('active');
      qs('#emailContinue').setAttribute('disabled', true);
      if (!/^\S+@\S+\.\S+$/.test(email)) {
        qs('#emailErr').textContent = 'Enter a valid email address';
        qs('#emailLoading').classList.remove('active');
        qs('#emailContinue').removeAttribute('disabled');
        return;
      }
      currentEmail = email;
      try {
        const res = await fetch(`${API_BASE}/auth/check-email`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });
        const json = await res.json();
        if (!res.ok) throw new Error(json.error || json.message || 'Server error');
        if (json.exists) {
          qs('#pwdFor').textContent = `for ${email}`;
          show('#step-password');
        } else {
          const send = await fetch(`${API_BASE}/auth/send-otp`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email }),
          });
          const sj = await send.json();
          if (!send.ok) throw new Error(sj.error || sj.message || 'Failed to send OTP');
          qs('#otpSentTo').textContent = `Enter the OTP sent to your email ${maskEmail(email)}`;
          otpGrid.querySelector('input')?.focus();
          startResendCountdown();
          show('#step-otp');
        }
      } catch (err) {
        qs('#emailErr').textContent = err.message;
      } finally {
        qs('#emailLoading').classList.remove('active');
        qs('#emailContinue').removeAttribute('disabled');
      }
    });

    // Back links
    qs('#backToEmailPwd').addEventListener('click', (e) => { e.preventDefault(); show('#step-email'); });
    qs('#backToEmailOtp').addEventListener('click', (e) => { e.preventDefault(); clearInterval(resendTimer); show('#step-email'); });
    qs('#backToEmailReset').addEventListener('click', (e) => { e.preventDefault(); show('#step-email'); });

    // Step 2a: Password login
    qs('#loginBtn').addEventListener('click', async () => {
      const password = qs('#password').value;
      qs('#passwordErr').textContent = '';
      if (!password || password.length < 8) {
        qs('#passwordErr').textContent = 'Password must be at least 8 characters';
        return;
      }
      try {
        const res = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: currentEmail, password }),
          credentials: 'include',
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Login failed');
        localStorage.setItem('accessToken', data.token);
        window.location.href = `${WEB_BASE}/dashboard`;
      } catch (err) {
        qs('#passwordErr').textContent = err.message;
      }
    });

    // Forgot Password
    qs('#forgotPassword').addEventListener('click', async (e) => {
      e.preventDefault();
      qs('#passwordErr').textContent = '';
      try {
        const res = await fetch(`${API_BASE}/auth/reset-password`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: currentEmail }),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed to send reset email');
        qs('#passwordErr').textContent = 'Password reset email sent. Check your inbox.';
      } catch (err) {
        qs('#passwordErr').textContent = err.message;
      }
    });

    // Step 2b: Verify OTP
    qs('#verifyOtpBtn').addEventListener('click', async () => {
      const digits = Array.from(otpGrid.querySelectorAll('input')).map(i => i.value).join('');
      qs('#otpErr').textContent = '';
      if (digits.length !== OTP_LENGTH) {
        qs('#otpErr').textContent = `Enter the ${OTP_LENGTH}-digit code`;
        return;
      }
      try {
        const { data, error } = await sb.auth.verifyOtp({
          email: currentEmail,
          token: digits,
          type: 'signup',
        });
        if (error) throw new Error(error.message);
        const { data: sessionData, error: sessionError } = await sb.auth.getSession();
        if (sessionError || !sessionData.session) throw new Error('Failed to get session');
        const accessToken = sessionData.session.access_token;
        const res = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: currentEmail, access_token: accessToken }),
          credentials: 'include',
        });
        const loginData = await res.json();
        if (!res.ok) throw new Error(loginData.error || 'Login failed');
        localStorage.setItem('accessToken', loginData.token);
        show('#step-setpwd');
      } catch (err) {
        qs('#otpErr').textContent = err.message || 'Invalid OTP';
      }
    });

    // Resend OTP
    qs('#resendOtp').addEventListener('click', async (e) => {
      e.preventDefault();
      if (qs('#resendOtp').hasAttribute('disabled')) return;
      qs('#otpErr').textContent = '';
      try {
        const res = await fetch(`${API_BASE}/auth/resend-otp`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: currentEmail }),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed to resend OTP');
        qs('#otpSentTo').textContent = `New OTP sent to ${maskEmail(currentEmail)}`;
        startResendCountdown();
      } catch (err) {
        qs('#otpErr').textContent = err.message;
      }
    });

    // Step 3: Set password
    qs('#setPwdBtn').addEventListener('click', async () => {
      const p1 = qs('#newPassword').value;
      const p2 = qs('#confirmPassword').value;
      const err = qs('#setPwdErr');
      err.textContent = '';
      if (!p1 || p1.length < 8) return err.textContent = 'Password must be at least 8 characters';
      if (p1 !== p2) return err.textContent = 'Passwords do not match';
      try {
        const { data, error } = await sb.auth.updateUser({ password: p1 });
        if (error) throw new Error(error.message);
        const res = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: currentEmail, password: p1 }),
          credentials: 'include',
        });
        const loginData = await res.json();
        if (!res.ok) throw new Error(loginData.error || 'Login failed');
        localStorage.setItem('accessToken', loginData.token);
        window.location.href = `${WEB_BASE}/dashboard`;
      } catch (err) {
        err.textContent = err.message;
      }
    });

    // Step 4: Reset password
    qs('#resetPwdBtn').addEventListener('click', async () => {
      const code = qs('#resetCode').value.trim();
      const p1 = qs('#resetNewPassword').value;
      const p2 = qs('#resetConfirmPassword').value;
      const err = qs('#resetPwdErr');
      err.textContent = '';
      if (!code) return err.textContent = 'Enter the reset code';
      if (!p1 || p1.length < 8) return err.textContent = 'Password must be at least 8 characters';
      if (p1 !== p2) return err.textContent = 'Passwords do not match';
      try {
        const { data, error } = await sb.auth.verifyOtp({
          email: currentEmail,
          token: code,
          type: 'recovery',
        });
        if (error) throw new Error(error.message);
        const { data: updateData, error: updateError } = await sb.auth.updateUser({ password: p1 });
        if (updateError) throw new Error(updateError.message);
        const res = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: currentEmail, password: p1 }),
          credentials: 'include',
        });
        const loginData = await res.json();
        if (!res.ok) throw new Error(loginData.error || 'Login failed');
        localStorage.setItem('accessToken', loginData.token);
        window.location.href = `${WEB_BASE}/dashboard`;
      } catch (err) {
        err.textContent = err.message || 'Invalid reset code';
      }
    });

    // Handle reset password URL params
    window.addEventListener('load', () => {
      const params = new URLSearchParams(window.location.search);
      const email = params.get('email');
      const code = params.get('code');
      if (email && code) {
        currentEmail = email;
        qs('#resetCode').value = code;
        show('#step-resetpwd');
      }
    });
  </script>
</body>
</html>